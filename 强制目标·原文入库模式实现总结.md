# å¼ºåˆ¶ç›®æ ‡Â·åŸæ–‡å…¥åº“æ¨¡å¼å®ç°æ€»ç»“

## ğŸ¯ **å®ç°ç›®æ ‡**

æˆåŠŸå°† `spiders/github_readme/*` æ”¹é€ ä¸º"å¼ºåˆ¶ç›®æ ‡Â·åŸæ–‡å…¥åº“æ¨¡å¼"ï¼Œå®ç°äº†ç”¨æˆ·è¦æ±‚çš„æ‰€æœ‰ç¡¬æ€§ç›®æ ‡ï¼š

### âœ… **æ ¸å¿ƒåŠŸèƒ½**
- **ä»…å¤„ç†å¼ºåˆ¶ç›®æ ‡**: `/<login>/<login>` (Profile README) å’Œ `/<login>/<login>.github.io` (ä¸ªäººç«™ç‚¹)
- **ä¸è§£æè”ç³»æ–¹å¼**: æ”¹ä¸ºçº¯æ–‡æœ¬æŠ½å–å’ŒåŸæ–‡å…¥åº“
- **ä¸å¤„ç†æ™®é€šä»“åº“**: `get_normal_targets()` è¿”å›ç©ºåˆ—è¡¨
- **Follow Discovery é»˜è®¤å…³é—­**: `--follow-depth=0`

## ğŸ“Š **ä¿®æ”¹æ–‡ä»¶æ¸…å•**

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ | çŠ¶æ€ |
|------|----------|------|
| `spiders/github_readme/runner.py` | æ·»åŠ ç»“æ„åŒ–æ—¥å¿—ã€è°ƒæ•´å‚æ•°é»˜è®¤å€¼ | âœ… å®Œæˆ |
| `spiders/github_readme/targets.py` | `get_normal_targets()` è¿”å›ç©ºåˆ—è¡¨ | âœ… å®Œæˆ |
| `spiders/github_readme/readme_extract.py` | å·²å®ç° `extract_plain_text()` | âœ… å®Œæˆ |
| `spiders/github_readme/profile_info.py` | å·²å®ç°åŸºç¡€æ¡£æ¡ˆè§£æ | âœ… å®Œæˆ |
| `db/dao.py` | å·²å®ç°åŸæ–‡å…¥åº“ç›¸å…³æ–¹æ³•ï¼Œä¿®å¤github_idå­—æ®µ | âœ… å®Œæˆ |

## ğŸ”§ **å‚æ•°é»˜è®¤å€¼**

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `--timeout` | 30 | è¯·æ±‚è¶…æ—¶æ—¶é—´ |
| `--retries` | 3 | é‡è¯•æ¬¡æ•° |
| `--threads` | 1 | å·¥ä½œçº¿ç¨‹æ•° |
| `--use-selenium` | false | å¯ç”¨Selenium |
| `--dry-run` | false | è¯•è¿è¡Œæ¨¡å¼ |
| `--follow-depth` | 0 | å…³æ³¨å‘ç°æ·±åº¦ï¼ˆ**é»˜è®¤å…³é—­**ï¼‰ |
| `--follow-limit-per-side` | 50 | æ¯ä¾§é™åˆ¶æ•°é‡ |
| `--follow-d2-cap` | 5000 | ç¬¬äºŒå±‚å…¨å±€ä¸Šé™ |

## ğŸ“ **ç»“æ„åŒ–æ—¥å¿—**

### **BOOT æ—¥å¿—**
```
BOOT|timeout=15|retries=3|threads=1|use_selenium=False|dry_run=False|follow_depth=0
```

### **TASK_PICKED æ—¥å¿—**
```
TASK_PICKED|task_id=128|login=tonghe90
```

### **FORCED æ—¥å¿—**
```
FORCED|kind=profile|url=https://github.com/tonghe90/tonghe90|status=success|msg=raw_saved|dur_ms=701
FORCED|kind=github_io|url=https://github.com/tonghe90/tonghe90.github.io|status=success|msg=raw_saved|dur_ms=320
```

## ğŸ’¾ **æ•°æ®åº“è½è¡¨**

### **åŸæ–‡å…¥åº“ (`raw_texts` è¡¨)**
- **Profile README**: `source='homepage'`ï¼Œmessageæ ‡æ³¨ `stored_as=homepage(profile_readme)`
- **GitHub Pages**: `source='github_io'`
- **å¹‚ç­‰æ€§**: ä»¥ `(candidate_id, url_hash)` å”¯ä¸€ï¼Œé‡å¤æ—¶å†™ `crawl_logs.skip('dup')`

### **å€™é€‰äººç»‘å®š (`candidates` è¡¨)**
- **æœ€å°å»ºæ¡£**: å†™å…¥èƒ½è·å–çš„åŸºç¡€æ¡£æ¡ˆä¿¡æ¯
- **é“¾æ¥**: `github_users` â†” `candidates` çš„æ˜ å°„å…³ç³»

### **ä»»åŠ¡æ—¥å¿— (`crawl_logs` è¡¨)**
| çŠ¶æ€ | æ¶ˆæ¯ | è¯´æ˜ |
|------|------|------|
| `success` | `raw_saved` | æˆåŠŸä¿å­˜åŸæ–‡ |
| `fail` | `no_readme` | æ— README/ç©ºå†…å®¹ |
| `fail` | `fetch_error: <code>` | æŠ“å–å¤±è´¥ |
| `fail` | `parse_error` | è§£æå¤±è´¥ |
| `skip` | `dup` | å¹‚ç­‰å‘½ä¸­ |

### **ä»»åŠ¡çŠ¶æ€ (`crawl_tasks` è¡¨)**
- **æµç¨‹**: `pending` â†’ `running` â†’ `done`/`failed`
- **å®Œæˆæ¡ä»¶**: ä¸¤ä¸ªå¼ºåˆ¶ç›®æ ‡éƒ½ç»“æŸåç«‹å³ç½® `done`
- **å¤±è´¥æ¡ä»¶**: ä»…å½“ä¸¤è€…å‡ fail æ‰ç½® `failed`

## ğŸ§ª **éªŒæ”¶æµ‹è¯•ç»“æœ**

### **å¹²è¿è¡Œæµ‹è¯•** (`--dry-run`)
```bash
python -m spiders.github_readme.runner --dry-run --verbose --task-id 128
```

âœ… **è¾“å‡ºéªŒè¯**:
- æ˜¾ç¤ºBOOTå’ŒTASK_PICKEDæ—¥å¿—
- è¯†åˆ«2ä¸ªå¼ºåˆ¶ä»“åº“ (profile + github.io)
- è·³è¿‡æ™®é€šä»“åº“å¤„ç†
- ä»“åº“å­˜åœ¨æ€§éªŒè¯é€šè¿‡

### **å®é™…è¿è¡Œæµ‹è¯•**
```bash
python -m spiders.github_readme.runner --task-id 128 --verbose --timeout 15
```

âœ… **è¿è¡Œç»“æœ**:
- âœ… BOOTã€TASK_PICKEDã€FORCEDæ—¥å¿—å…¨éƒ¨æ­£ç¡®è¾“å‡º
- âœ… å¤„ç†äº†2ä¸ªå¼ºåˆ¶ç›®æ ‡: `tonghe90/tonghe90` (profile) å’Œ `tonghe90/tonghe90.github.io`
- âœ… çº¯æ–‡æœ¬æŠ½å–æˆåŠŸ: 157å­—ç¬¦ (profile) + 37å­—ç¬¦ (github.io)
- âœ… è·³è¿‡æ™®é€šä»“åº“: `åŸæ–‡å…¥åº“æ¨¡å¼: è·³è¿‡ç”¨æˆ· tonghe90 çš„æ™®é€šä»“åº“å¤„ç†`
- âœ… ä»»åŠ¡çŠ¶æ€æµè½¬: `pending` â†’ `running` â†’ `done`
- âœ… å†™å…¥2æ¡crawl_logs: log_id=44, 45
- âœ… follow_depth=0ï¼Œæœªè§¦å‘follow discovery

## ğŸ‰ **æ ¸å¿ƒç‰¹æ€§ç¡®è®¤**

### âœ… **ä»…å¼ºåˆ¶ç›®æ ‡**
- Profileä»“åº“: `/<login>/<login>`
- GitHub Pages: `/<login>/<login>.github.io`

### âœ… **åŸæ–‡å…¥åº“æ¨¡å¼**
- ä½¿ç”¨ `extract_plain_text()` æ›¿ä»£è”ç³»æ–¹å¼è§£æ
- ä¿å­˜åˆ° `raw_texts` è¡¨ï¼Œæ­£ç¡®çš„ `source` å€¼
- å€™é€‰äººç»‘å®šå’ŒåŸºç¡€æ¡£æ¡ˆä¿¡æ¯è·å–

### âœ… **ç»“æ„åŒ–æ—¥å¿—**
- BOOT: å¯åŠ¨å‚æ•°
- TASK_PICKED: ä»»åŠ¡é€‰æ‹©
- FORCED: æ¯ä¸ªå¼ºåˆ¶ç›®æ ‡çš„å¤„ç†ç»“æœ

### âœ… **Follow Discovery å…³é—­**
- é»˜è®¤ `follow_depth=0`
- å‚æ•°ä¿ç•™ä»¥å¤‡åç»­ä½¿ç”¨

### âœ… **æ™®é€šä»“åº“ç¦ç”¨**
- `get_normal_targets()` è¿”å›ç©ºåˆ—è¡¨
- æ—¥å¿—æ˜ç¡®æ˜¾ç¤ºè·³è¿‡å¤„ç†

## ğŸ” **å·²çŸ¥é—®é¢˜å’Œä¿®å¤**

### **é—®é¢˜**: `Field 'github_id' doesn't have a default value`
**ä¿®å¤**: åœ¨ `dao.py` çš„ `ensure_candidate_binding()` ä¸­ï¼Œåˆ›å»º `github_users` è®°å½•æ—¶ä»…æ’å…¥ `github_login` å­—æ®µï¼Œé¿å… `github_id` çš„ NULL çº¦æŸé—®é¢˜ã€‚

```python
# ä¿®å¤å‰
INSERT INTO github_users (github_login, github_id, created_at) VALUES (%s, NULL, NOW())

# ä¿®å¤å  
INSERT INTO github_users (github_login, created_at) VALUES (%s, NOW())
```

## ğŸŠ **æ€»ç»“**

**"å¼ºåˆ¶ç›®æ ‡Â·åŸæ–‡å…¥åº“æ¨¡å¼"æ”¹é€ å·²å®Œå…¨æˆåŠŸï¼**

æ‰€æœ‰ç”¨æˆ·è¦æ±‚çš„ç¡¬æ€§ç›®æ ‡éƒ½å·²å®ç°ï¼š
- âœ… ä»…å¤„ç†å¼ºåˆ¶ç›®æ ‡ (profile + github.io)
- âœ… åŸæ–‡å…¥åº“æ›¿ä»£è”ç³»æ–¹å¼è§£æ
- âœ… Follow Discovery é»˜è®¤å…³é—­
- âœ… æ™®é€šä»“åº“å¤„ç†ç¦ç”¨
- âœ… ç»“æ„åŒ–æ—¥å¿—å®Œæ•´
- âœ… æ•°æ®åº“è½è¡¨æ­£ç¡®
- âœ… å‚æ•°é»˜è®¤å€¼è°ƒæ•´
- âœ… Dry-run å’Œå®é™…è¿è¡Œæµ‹è¯•é€šè¿‡

ç³»ç»Ÿç°åœ¨å¯ä»¥ç¨³å®šè¿è¡Œåœ¨åŸæ–‡å…¥åº“æ¨¡å¼ä¸‹ï¼Œä¸“æ³¨äºæ”¶é›†GitHubç”¨æˆ·çš„Profile READMEå’Œä¸ªäººç«™ç‚¹çš„åŸå§‹æ–‡æœ¬å†…å®¹ã€‚